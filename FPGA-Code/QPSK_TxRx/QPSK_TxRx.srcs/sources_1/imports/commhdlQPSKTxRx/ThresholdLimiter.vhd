-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj\hdlsrc\commhdlQPSKTxRx\ThresholdLimiter.vhd
-- Created: 2024-01-25 16:33:03
-- 
-- Generated by MATLAB 23.2, HDL Coder 23.2, and Simulink 23.2
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: ThresholdLimiter
-- Source Path: commhdlQPSKTxRx/QPSK Rx/Frequency and Time Synchronizer/Preamble Detector/Correlator/ThresholdLimiter
-- Hierarchy Level: 4
-- Model version: 7.26
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY ThresholdLimiter IS
  PORT( x                                 :   IN    std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
        y                                 :   OUT   std_logic_vector(31 DOWNTO 0)  -- sfix32_En28
        );
END ThresholdLimiter;


ARCHITECTURE rtl OF ThresholdLimiter IS

  -- Signals
  SIGNAL x_signed                         : signed(31 DOWNTO 0);  -- sfix32_En28
  SIGNAL y_tmp                            : signed(31 DOWNTO 0);  -- sfix32_En28

BEGIN
  x_signed <= signed(x);

  -- Apply a lower limit to the threshold.
  -- Threshold is computed by summing across 63 samples.
  -- Set lower limit to be equivalent of all 63 samples
  -- having their LSB set to 1 and all others set to 0. 
  
  y_tmp <= to_signed(2684354, 32) WHEN x_signed < to_signed(2684354, 32) ELSE
      x_signed;

  y <= std_logic_vector(y_tmp);

END rtl;

